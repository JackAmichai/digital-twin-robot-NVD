{{- if .Values.secrets.create }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "digital-twin.fullname" . }}-credentials
  labels:
    {{- include "digital-twin.labels" . | nindent 4 }}
type: Opaque
data:
  # NGC API Key for NVIDIA services (base64 encoded)
  ngc-api-key: {{ .Values.secrets.ngcApiKey | b64enc | quote }}
  
  # Redis password
  redis-password: {{ .Values.secrets.redisPassword | b64enc | quote }}
  
  # API authentication key
  api-key: {{ .Values.secrets.apiKey | b64enc | quote }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "digital-twin.fullname" . }}-tls
  labels:
    {{- include "digital-twin.labels" . | nindent 4 }}
type: kubernetes.io/tls
data:
  # TLS certificate and key (base64 encoded)
  tls.crt: {{ .Values.secrets.tlsCert | b64enc | quote }}
  tls.key: {{ .Values.secrets.tlsKey | b64enc | quote }}
---
# Docker registry credentials for NGC
{{- if .Values.secrets.imagePullSecret.create }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "digital-twin.fullname" . }}-registry
  labels:
    {{- include "digital-twin.labels" . | nindent 4 }}
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: {{ template "imagePullSecret" . }}
{{- end }}
{{- end }}
---
# External Secrets Operator integration (optional)
{{- if .Values.externalSecrets.enabled }}
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "digital-twin.fullname" . }}-external
  labels:
    {{- include "digital-twin.labels" . | nindent 4 }}
spec:
  refreshInterval: {{ .Values.externalSecrets.refreshInterval }}
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStoreRef.name }}
    kind: {{ .Values.externalSecrets.secretStoreRef.kind }}
  target:
    name: {{ include "digital-twin.fullname" . }}-external-secrets
    creationPolicy: Owner
  data:
    - secretKey: ngc-api-key
      remoteRef:
        key: {{ .Values.externalSecrets.ngcApiKeyPath }}
    - secretKey: redis-password
      remoteRef:
        key: {{ .Values.externalSecrets.redisPasswordPath }}
    - secretKey: api-key
      remoteRef:
        key: {{ .Values.externalSecrets.apiKeyPath }}
{{- end }}
